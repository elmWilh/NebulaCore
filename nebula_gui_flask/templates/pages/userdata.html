{% extends "layout.html" %}
{#
  nebula_gui_flask/templates/pages/userdata.html
  Copyright (c) 2026 Monolink Systems
  Licensed under AGPLv3 (Nebula Open Source Edition, non-corporate)
#}
{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/userdata.css') }}">
{% endblock %}
{% block extra_js %}
<script>
window.NebulaUserdata = {
    profileUsername: {{ user.username|tojson }},
    profileDbName: {{ user.db_name|tojson }}
};
</script>
<script src="{{ url_for('static', filename='js/pages/userdata.js') }}"></script>
{% endblock %}
{% block page_content %}
<div class="container-fluid" style="padding: 24px;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; gap: 12px; flex-wrap: wrap;">
        <div style="display: flex; align-items: center; gap: 12px;">
            <a href="{{ '/users' if session.get('is_staff') else '/userpanel' }}" class="back-btn"><i class="bi bi-arrow-left"></i></a>
            <div>
                <h2 style="font-weight: 700; margin: 0; color: white;">User Profile: <span id="profile-username">{{ user.username }}</span></h2>
                <p style="margin: 0; font-size: 0.8rem; color: var(--text-muted);">UUID: <span id="profile-uuid">-</span> â€¢ DB: <span id="profile-db">{{ user.db_name }}</span></p>
            </div>
        </div>
        <div style="display: flex; gap: 10px;">
            <button class="btn-secondary" onclick="loadProfileData()"><i class="bi bi-arrow-clockwise"></i> Sync</button>
            <a class="btn-primary" href="/userpanel"><i class="bi bi-person-circle"></i> Open User Panel</a>
        </div>
    </div>

    <div class="stats-grid">
        <div class="stat-card"><i class="bi bi-box"></i><div><span class="label">Containers</span><div class="value" id="stat-containers">0</div></div></div>
        <div class="stat-card"><i class="bi bi-play-circle"></i><div><span class="label">Running</span><div class="value" id="stat-running">0</div></div></div>
        <div class="stat-card"><i class="bi bi-cpu"></i><div><span class="label">CPU</span><div class="value" id="stat-cpu">0%</div></div></div>
        <div class="stat-card"><i class="bi bi-memory"></i><div><span class="label">RAM</span><div class="value" id="stat-ram">0%</div></div></div>
    </div>

    <div class="main-profile-grid">
        <div class="content-card">
            <div class="card-header"><i class="bi bi-person-vcard"></i> Identity & Core Data</div>
            <div class="card-body">
                <div class="data-row">
                    <div class="avatar-large"><i class="bi bi-person-fill"></i></div>
                    <div style="flex: 1;">
                        <div class="info-group">
                            <label>Email Address</label>
                            <span id="profile-email">-</span>
                        </div>
                        <div class="info-group">
                            <label>Root Directory</label>
                            <code class="code-block" id="profile-root">-</code>
                        </div>
                        <div class="info-group" style="margin-bottom:0;">
                            <label>Role</label>
                            <span id="profile-role">-</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="content-card">
            <div class="card-header"><span><i class="bi bi-box-seam"></i> Virtual Instances</span><span class="badge-count" id="instance-count">0 visible</span></div>
            <div class="card-table-wrapper">
                <table class="sub-table">
                    <thead><tr><th>Name / ID</th><th>Image</th><th>Status</th><th style="text-align:right;">Action</th></tr></thead>
                    <tbody id="instances-body"><tr><td colspan="4" style="padding:14px; color: var(--text-muted);">Loading...</td></tr></tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}
