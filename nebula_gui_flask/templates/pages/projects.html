{% extends "layout.html" %}
{#
  nebula_gui_flask/templates/pages/projects.html
  Copyright (c) 2026 Monolink Systems
  Licensed under AGPLv3 (Nebula Open Source Edition, non-corporate)
#}
{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/containers.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/projects.css') }}">
{% endblock %}

{% block page_content %}
<div class="container-fluid" style="padding: 24px;">
    
    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 32px;">
        <div>
            <h2 style="font-weight: 700; color: white; margin: 0;">Project Management</h2>
            <div class="project-tabs" style="margin-top: 20px;">
                <div class="tab-item active"><i class="bi bi-lightning-charge"></i> Active</div>
                <div class="tab-item"><i class="bi bi-archive"></i> Archived</div>
                <div class="tab-item"><i class="bi bi-cloud-download"></i> Backups</div>
            </div>
        </div>
        <button onclick="openModal('createModal')" class="add-user-btn" style="border: none; cursor: pointer;">
            <i class="bi bi-plus-lg"></i> <span>Create Project</span>
        </button>
    </div>

    <div class="table-card">
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr class="table-header-row">
                    <th style="padding: 18px 24px; width: 50px;"></th>
                    <th style="padding: 18px 24px;">Project Name</th>
                    <th style="padding: 18px 24px;">Team</th>
                    <th style="padding: 18px 24px;">Total Load</th>
                    <th style="padding: 18px 24px; text-align: right;">Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr class="project-row" onclick="toggleProject('proj_1')">
                    <td style="text-align: center;"><i class="bi bi-chevron-right" id="icon_proj_1"></i></td>
                    <td style="padding: 18px 24px;">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div class="container-icon-bg"><i class="bi bi-boxes"></i></div>
                            <div>
                                <div style="font-weight: 700; color: white;">Amazon Production</div>
                                <div style="font-size: 0.75rem; color: var(--text-muted);">Main warehouse cluster</div>
                            </div>
                        </div>
                    </td>
                    <td style="padding: 18px 24px;">
                        <div class="avatar-group" onclick="event.stopPropagation(); openModal('teamModal')">
                            <div class="avatar-mini">JD</div>
                            <div class="avatar-mini" style="background: #f59e0b;">AM</div>
                            <div class="avatar-mini" style="background: #3f3f46;">+2</div>
                        </div>
                    </td>
                    <td style="padding: 18px 24px;">
                        <div style="display: flex; gap: 8px;">
                            <span class="badge badge-user" style="background: rgba(255,255,255,0.05); border: 1px solid var(--border);">1.2 CPU</span>
                            <span class="badge badge-user" style="background: rgba(255,255,255,0.05); border: 1px solid var(--border);">4GB RAM</span>
                        </div>
                    </td>
                    <td style="padding: 18px 24px; text-align: right;">
                        <div style="display: flex; justify-content: flex-end; gap: 8px;" onclick="event.stopPropagation()">
                            <button class="action-btn" onclick="openModal('settingsModal')"><i class="bi bi-sliders"></i></button>
                            <button class="action-btn" style="color: #ef4444;"><i class="bi bi-trash3"></i></button>
                        </div>
                    </td>
                </tr>

                <tr id="proj_1" class="project-details">
                    <td colspan="5">
                        <div class="details-container">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <h4 style="margin: 0; color: white; font-size: 0.8rem; text-transform: uppercase;">Linked Infrastructure</h4>
                                <button class="btn-secondary" style="padding: 6px 12px; font-size: 0.75rem;">+ Link Container</button>
                            </div>
                            <div class="container-grid">
                                <div class="resource-card">
                                    <div style="display: flex; align-items: center;">
                                        <span class="status-dot status-online"></span>
                                        <span style="color: #eee; font-size: 0.85rem; font-weight: 600;">web-frontend-01</span>
                                    </div>
                                    <i class="bi bi-link-45deg" style="color: var(--text-muted);"></i>
                                </div>
                                <div class="resource-card">
                                    <div style="display: flex; align-items: center;">
                                        <span class="status-dot status-offline"></span>
                                        <span style="color: #eee; font-size: 0.85rem; font-weight: 600;">redis-cache-db</span>
                                    </div>
                                    <i class="bi bi-link-45deg" style="color: var(--text-muted);"></i>
                                </div>
                            </div>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<div id="createModal" class="modal-overlay">
    <div class="modal-content" style="width: 500px;">
        <div class="modal-header">
            <h3 style="margin:0; color: white;">New Project</h3>
            <button onclick="closeModal('createModal')" class="close-modal-btn">&times;</button>
        </div>
        <div style="padding: 24px;">
            <div class="input-field">
                <label>Project Name</label>
                <div class="input-wrapper"><i class="bi bi-tag"></i><input type="text" placeholder="e.g. SkyNet Core"></div>
            </div>
            <div class="input-field" style="margin-top: 15px;">
                <label>Description</label>
                <div class="input-wrapper"><i class="bi bi-text-left"></i><textarea rows="3" placeholder="Project goals..."></textarea></div>
            </div>
            <div class="input-field" style="margin-top: 15px;">
                <label>Tags (Comma separated)</label>
                <div class="input-wrapper"><i class="bi bi-hash"></i><input type="text" placeholder="prod, internal, web"></div>
            </div>
        </div>
        <div class="modal-footer">
            <button onclick="closeModal('createModal')" class="btn-secondary">Cancel</button>
            <button class="btn-primary">Create</button>
        </div>
    </div>
</div>

<div id="settingsModal" class="modal-overlay">
    <div class="modal-content" style="width: 500px;">
        <div class="modal-header">
            <h3 style="margin:0; color: white;">Project Settings</h3>
            <button onclick="closeModal('settingsModal')" class="close-modal-btn">&times;</button>
        </div>
        <div style="padding: 24px;">
            <div class="input-field">
                <label>Edit Name</label>
                <div class="input-wrapper"><i class="bi bi-pencil"></i><input type="text" value="Amazon Production"></div>
            </div>
            <div class="input-field" style="margin-top: 15px;">
                <label>Edit Description</label>
                <div class="input-wrapper"><i class="bi bi-justify-left"></i><textarea rows="3">Main warehouse cluster</textarea></div>
            </div>
            <div class="input-field" style="margin-top: 15px;">
                <label>Tags</label>
                <div class="input-wrapper"><i class="bi bi-hash"></i><input type="text" value="warehouse, production"></div>
            </div>
        </div>
        <div class="modal-footer">
            <button onclick="closeModal('settingsModal')" class="btn-secondary">Discard</button>
            <button class="btn-primary">Save Changes</button>
        </div>
    </div>
</div>

<div id="teamModal" class="modal-overlay">
    <div class="modal-content" style="width: 400px;">
        <div class="modal-header">
            <h3 style="margin:0; color: white;">Project Team</h3>
            <button onclick="closeModal('teamModal')" class="close-modal-btn">&times;</button>
        </div>
        <div style="padding: 20px;">
            <div class="users-list">
                <div class="user-option">
                    <div style="display:flex; align-items:center; gap:10px;">
                        <div class="user-avatar-mini">JD</div>
                        <span style="color:white;">John Doe (Owner)</span>
                    </div>
                </div>
            </div>
            <button class="btn-primary" style="width:100%; margin-top:20px;">Invite User</button>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script nonce="{{ csp_nonce }}">
    function toggleProject(id) {
        const row = document.getElementById(id);
        const icon = document.getElementById('icon_' + id);
        row.classList.toggle('active');
        icon.style.transform = row.classList.contains('active') ? 'rotate(90deg)' : 'rotate(0deg)';
    }

    function openModal(id) { document.getElementById(id).style.display = 'flex'; }
    function closeModal(id) { document.getElementById(id).style.display = 'none'; }

    window.onclick = function(e) {
        if (e.target.classList.contains('modal-overlay')) { e.target.style.display = 'none'; }
    }
</script>
{% endblock %}
