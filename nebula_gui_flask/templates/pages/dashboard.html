{% extends "layout.html" %}
{#
  nebula_gui_flask/templates/pages/dashboard.html
  Copyright (c) 2026 Monolink Systems
  Licensed under AGPLv3 (Nebula Open Source Edition, non-corporate)
#}
{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/dashboard.css') }}">
{% endblock %}
{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script src="{{ url_for('static', filename='js/pages/dashboard.js') }}"></script>
{% endblock %}

{% block page_content %}
<div class="grid">
  <div class="card">
    <div class="card-title">CPU Usage</div>
    <div class="card-value" id="cpu">—</div>
  </div>
  <div class="card">
    <div class="card-title">RAM Usage</div>
    <div class="card-value" id="ram">—</div>
  </div>
  <div class="card">
    <div class="card-title">Disk Storage</div>
    <div class="card-value" id="disk">—</div>
  </div>
  <div class="card">
    <div class="card-title">Network Throughput</div>
    <div class="card-value" id="network">—</div>
  </div>
  <div class="card">
    <div class="card-title">Active Containers</div>
    <div class="card-value" id="containers">—</div>
  </div>
  <div class="card">
    <div class="card-title">Servers Online</div>
    <div class="card-value" id="servers">—</div>
  </div>
  <div class="card">
    <div class="card-title">Critical Alerts</div>
    <div class="card-value" id="alerts">—</div>
  </div>
  <div class="card">
    <div class="card-title">Tasks in Queue</div>
    <div class="card-value" id="tasks">—</div>
  </div>
</div>

{% if session.get('is_staff') %}
<div class="admin-observatory">
  <div class="observatory-header">
    <div>
      <h2>Admin Observatory</h2>
      <p>Live server telemetry and container memory map</p>
    </div>
    <div class="observatory-status">
      <span class="status-dot"></span>
      <span id="admin-metrics-updated">syncing...</span>
    </div>
  </div>

  <div class="observatory-grid">
    <section class="obs-card obs-card-wide">
      <div class="obs-card-head">
        <h3>RAM Usage Timeline</h3>
        <span id="ram-quick">—</span>
      </div>
      <div class="chart-box chart-box-line">
        <canvas id="ramTimelineChart"></canvas>
      </div>
    </section>

    <section class="obs-card obs-card-wide">
      <div class="obs-card-head">
        <h3>Network Throughput</h3>
        <span id="network-quick">—</span>
      </div>
      <div class="chart-box chart-box-line">
        <canvas id="networkTimelineChart"></canvas>
      </div>
    </section>

    <section class="obs-card obs-card-third">
      <div class="obs-card-head">
        <h3>Container RAM Distribution</h3>
        <span id="containers-mem-total">—</span>
      </div>
      <div class="chart-box chart-box-donut">
        <canvas id="containerMemoryChart"></canvas>
      </div>
    </section>

    <section class="obs-card obs-card-third">
      <div class="obs-card-head">
        <h3>Container Disk Distribution</h3>
        <span id="containers-disk-total">—</span>
      </div>
      <div class="chart-box chart-box-donut">
        <canvas id="containerDiskChart"></canvas>
      </div>
    </section>

    <section class="obs-card obs-card-third disks-card">
      <div class="obs-card-head">
        <h3>Available Disks</h3>
        <span id="disk-count">0</span>
      </div>
      <div class="disks-list" id="disks-list">
        <div class="disk-row disk-empty">No disk data</div>
      </div>
    </section>
  </div>
</div>
{% endif %}
{% endblock %}
